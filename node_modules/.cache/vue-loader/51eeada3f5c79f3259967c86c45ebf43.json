{"remainingRequest":"/home/aigul/projects/rtsp_stream_v2/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/aigul/projects/rtsp_stream_v2/src/views/synchronize.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/home/aigul/projects/rtsp_stream_v2/src/views/synchronize.vue","mtime":1614288011997},{"path":"/home/aigul/projects/rtsp_stream_v2/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/aigul/projects/rtsp_stream_v2/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/aigul/projects/rtsp_stream_v2/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/aigul/projects/rtsp_stream_v2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/aigul/projects/rtsp_stream_v2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKYm9keSB7CiAgbWFyZ2luOiAwOwp9CgouY2FudmFzZXMgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKfQoKLm15Q2FudmFzIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgd2lkdGg6IDY0MHB4OwogIGhlaWdodDogMzIwcHg7CiAgdG9wOiAwcHgKfQoucGxhbiB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMHB4OwogIGxlZnQ6IDcwMHB4Cn0K"},{"version":3,"sources":["synchronize.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyPA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"synchronize.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"synchronize\">\n    <b-row class=\"m-0\">\n      <b-col cols=\"4\">\n        <h2>{{message}} {{id}}</h2>\n      </b-col>\n      <b-col class=\"float-right\">\n          <div v-if=\"!isDrawing1\">\n            <b-button v-on:click=\"deleteArea\" variant=\"secondary\" class=\"mx-2\">Заново</b-button>\n            <b-button v-on:click=\"toSynch\" variant=\"secondary\" class=\"mx-2\" v-if=\"!isSynch\">Синхронизировать с планом</b-button>\n            <b-button v-on:click=\"save(recs[0], points)\" variant=\"dark\" class=\"mx-2\">Сохранить</b-button>\n            <b-button v-on:click=\"recs=[]; isDrawing=true\" variant=\"dark\" class=\"mx-2\" v-if=\"rect!=null\">Отменить</b-button>\n          </div>\n          <div v-else>\n            <b-button v-if=\"i>3\" v-on:click=\"closeArea\" variant=\"dark\" class=\"mx-2\">Замкнуть область</b-button>\n            <b-button v-on:click=\"delDrawingArea\" variant=\"dark\" class=\"mx-2\">Отменить</b-button>\n          </div>\n      </b-col>\n    </b-row>\n\n    <div class=\"canvases\">\n      <img class=\"myCanvas\" style=\"z-index: 10\" :src=\"'http://192.168.1.104:5000/api/cameras/'+id\">\n      <canvas ref=\"canvas\" id='drawing-pad' width='640' height=\"320\" style=\"z-index: 100; border: 2px solid black\"\n              class=\"myCanvas\">\n        This is an interactive drawing pad.\n      </canvas>\n    </div>\n\n    <div class=\"canvases\">\n      <b-img v-if=\"isSynch\" class=\"plan\" src=\"/plan1.png\" height=\"350\" width=\"750\"></b-img>\n<!--      <canvas ref=\"canvas2\" id='drawing-pad2' width='750' height=\"350\" style=\"z-index: 100\"-->\n<!--              class=\"plan\">-->\n<!--        This is an interactive drawing pad.-->\n<!--      </canvas>-->\n      <v-stage\n          class=\"plan\" style=\"z-index: 100\"\n          ref=\"stage\"\n          :config=\"stageSize\"\n          @mousemove=\"handleMouseMove\"\n          @mouseDown=\"handleMouseDown\"\n          @mouseUp=\"handleMouseUp\"\n      >\n        <v-layer ref=\"layer\">\n          <v-rect\n              v-for=\"(rec, index) in recs\"\n              :key=\"index\"\n              :config=\"{\n          x: Math.min(rec.startPointX, rec.startPointX + rec.width),\n          y: Math.min(rec.startPointY, rec.startPointY + rec.height),\n          width: Math.abs(rec.width),\n          height: Math.abs(rec.height),\n          fill: 'rgb(255,0,0,0.4)',\n          stroke: 'black',\n            draggable: true,\n          strokeWidth: 3,\n        }\"\n          />\n        </v-layer>\n      </v-stage>\n    </div>\n\n<!--    <div style=\"margin-top: 400px\">-->\n<!--    </div>-->\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nconst width = 750;\nconst height = 350;\n\nexport default {\n  name: \"synchronize.vue\",\n  props: ['id'],\n  data: () => ({\n    message: 'Выберите рабочую область',\n    points: [],\n    i: 0,\n    x: null, y: null,\n    ax: null, ay: null,\n    canvas: null,\n    context: null,\n    isDrawing1: true,\n    rect: null,\n    isSynch: false,\n    stageSize: {\n      width: width,\n      height: height,\n    },\n    lines: [],\n    isDrawing: false,\n    recs: [],\n  }),\n  mounted() {\n    this.canvas = this.$refs.canvas\n    this.context = this.canvas.getContext(\"2d\"); //ctx\n    this.context.lineWidth = 2;\n    this.context.strokeStyle = \"blue\"\n    this.context.fillStyle = \"rgba(0,255,255,0.4)\"\n    this.rect = this.canvas.getBoundingClientRect()\n    this.canvas.addEventListener('click', this.click)\n  },\n  methods: {\n    handleMouseDown(event) {\n      const pos = this.$refs.stage.getNode().getPointerPosition();\n      this.recs = [\n        ...this.recs,\n        { startPointX: pos.x, startPointY: pos.y, width: 0, height: 0 },\n      ];\n    },\n    handleMouseUp() {\n      this.isDrawing = false;\n      if (this.recs.length>0){\n        console.log(this.rect)\n      }\n    },\n    handleMouseMove(event) {\n      // no drawing - skipping\n      if (!this.isDrawing) {\n        return;\n      }\n      const point = this.$refs.stage.getNode().getPointerPosition();\n      // handle  rectangle part\n      let curRec = this.recs[this.recs.length - 1];\n      curRec.width = point.x - curRec.startPointX;\n      curRec.height = point.y - curRec.startPointY;\n    },\n\n    save(recs, points){\n      var id = this.id\n      if(this.isSynch){\n        console.log('Synchronizated')\n        points = this.arrPxToProc(points)\n        recs = this.recsToProcent(recs)\n        this.$router.push({name: 'home'}, this.sendConfig(recs, points, id))\n        // this.$router.push({name: 'postSynch', props: {id: this.id, points: points, recs: recs}})\n      }\n      else {\n        console.log('Not synchronizated')\n        console.log(this.arrPxToProc(points))\n      }\n    },\n    sendConfig(recs, points, id){\n\n      console.log(recs)\n      console.log(points)\n      console.log(id)\n\n      axios.put(`http://192.168.1.104:5000/api/cameras/${id}`, {\n        numeric_dataset: {\n          cy: recs.startPointY,\n          cx: recs.startPointX,\n          ah: recs.height,\n          aw: recs.width\n        },\n        isomeric_dataset: {\n          a1: points[0],\n          b1: points[1],\n          c1: points[2],\n          d1: points[3]\n        }\n      })\n          .then(function (response) {\n            console.log(response)\n          })\n          .catch(function (error) {\n            console.log(error);\n          })\n    },\n    toSynch(){\n      this.isDrawing = true;\n      this.isSynch = true\n      this.message = \"Синхронизация с планом\"\n    },\n    closeArea: function () {\n      this.i = 0\n      this.x = null\n      this.y = null\n      this.context.closePath()\n      this.context.fill();\n      this.context.stroke();\n      this.isDrawing1=false\n    },\n    deleteArea() {\n        this.delDrawingArea()\n      this.isDrawing1 = true\n        this.isSynch = false\n      this.isDrawing = false\n      this.recs=[]\n    },\n    delDrawingRect(){\n      this.recs=[]\n    },\n    delDrawingArea() {\n      this.points = []\n      this.i = 0\n      this.x = null\n      this.y = null\n\n      this.context.clearRect(0, 0, this.rect.width, this.rect.height)\n    },\n    click(e) {\n      var x = e.clientX - this.rect.left\n      var y = e.clientY - this.rect.top\n      if (this.isDrawing1) {\n        this.points.push([x, y])\n        if (this.i == 0) {\n          this.context.beginPath();\n          this.context.moveTo(x, y);\n        }\n        if (this.i > 0) {\n          this.context.lineTo(x, y);\n          this.context.stroke();\n          if (Math.abs(x - this.points[0][0]) < 10 && Math.abs(y - this.points[0][1]) < 10) {\n            this.closeArea()\n            return 0\n          }\n        }\n        this.i++\n        if (this.i===4){\n          this.closeArea()\n        }\n      }\n    },\n    pxToProcent(x, y) {\n      return [Math.round((x / this.rect.width) * 100), Math.round((y / this.rect.height) * 100)]\n    },\n    recsToProcent(rect){\n      var rect1={}\n      rect1.startPointX = Math.round((rect.startPointX / width) * 100)\n      rect1.startPointY = Math.round((rect.startPointY / height) * 100)\n      rect1.width = Math.round((rect.width / width) * 100)\n      rect1.height = Math.round((rect.height / height) * 100)\n      // console.log(rect)\n      return rect1\n    },\n    arrPxToProc(arr) {\n      var arr1 = [], dot\n      for (var i = 0; i < arr.length; i++) {\n          dot = this.pxToProcent(arr[i][0], arr[i][1])\n          arr1.push([dot])\n        }\n      return arr1\n    },\n  }\n}\n</script>\n\n<style>\nbody {\n  margin: 0;\n}\n\n.canvases {\n  position: relative;\n}\n\n.myCanvas {\n  position: absolute;\n  width: 640px;\n  height: 320px;\n  top: 0px\n}\n.plan {\n  position: absolute;\n  top: 0px;\n  left: 700px\n}\n</style>"]}]}