{"remainingRequest":"/home/aigul/projects/rtsp_stream_v2/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/aigul/projects/rtsp_stream_v2/src/views/addController.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/aigul/projects/rtsp_stream_v2/src/views/addController.vue","mtime":1614772409852},{"path":"/home/aigul/projects/rtsp_stream_v2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/aigul/projects/rtsp_stream_v2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBjb250cm9sbGVycyBmcm9tICJAL3ZpZXdzL2NvbnRyb2xsZXJzIjsKaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKZXhwb3J0IGRlZmF1bHQgewpuYW1lOiAiYWRkQ29udHJvbGxlci52dWUiLAogIHByb3BzOiBbJ2FycicsICdpZCddLAogIGNvbXBvbmVudHM6IHsKICAgIGNvbnRyb2xsZXJzCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29udHJvbGxlcnM6IFtdLAogICAgICBzZWxlY3RlZERldmljZXM6IFtdLAogICAgICBjb2x1bW5zOiBbCiAgICAgICAge2tleTogJ2lkJywgbGFiZWw6ICdJRCd9LAogICAgICAgIHtrZXk6ICdidXR0b24xJywgbGFiZWw6ICfQn9C+0LTQsNGC0Ywg0YHQuNCz0L3QsNC7J30sCiAgICAgICAge2tleTogJ2J1dHRvbjInLCBsYWJlbDogJ9CS0YvQsdGA0LDRgtGMJ30sCiAgICAgIF0sCiAgICAgIGdyb3VwQWxlcnQ6IGZhbHNlLAogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuZ2V0RnJlZURldmljZXMoKQogIH0sCiAgbWV0aG9kczogewogICAgZ2V0RnJlZURldmljZXMoKSB7CiAgICAgIGF4aW9zLmdldCgnL2FwaS9jb250cm9sbGVycycpCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiAodGhpcy5jb250cm9sbGVycyA9IHJlc3BvbnNlLmRhdGEpKTsKICAgIH0sCiAgICBhc3luYyBjaG9vc2VEZXZpdmUoaWQpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ2Nob29zaW5nICcgKyBpZCk7CiAgICAgIHRoaXMuc2VsZWN0ZWREZXZpY2VzLnB1c2godGhpcy5jb250cm9sbGVyc1tpZF0pCiAgICAgIHRoaXMuY29udHJvbGxlcnMuc3BsaWNlKGlkLCAxKQogICAgfSwKICAgIGFzeW5jIGRlbGV0ZURldml2ZShpZCwgY2lkKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdkZWxldGluZyAnICsgaWQpOwogICAgICB0aGlzLmNvbnRyb2xsZXJzLnB1c2godGhpcy5zZWxlY3RlZERldmljZXNbaWRdKQogICAgICB0aGlzLnJlbW92ZUJ5QXR0cih0aGlzLnNlbGVjdGVkRGV2aWNlcywgJ2NpZCcsIGNpZCkKICAgIH0sCiAgICBhc3luYyByZW1vdmVCeUF0dHIoYXJyLCBhdHRyLCB2YWx1ZSl7CiAgICAgIHZhciBpID0gYXJyLmxlbmd0aDsKICAgICAgd2hpbGUoaS0tKXsKICAgICAgICBpZiggYXJyW2ldCiAgICAgICAgICAgICYmIGFycltpXS5oYXNPd25Qcm9wZXJ0eShhdHRyKQogICAgICAgICAgICAmJiAoYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJyW2ldW2F0dHJdID09PSB2YWx1ZSApICl7CiAgICAgICAgICBhcnIuc3BsaWNlKGksMSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBhcnI7CiAgICB9LAogICAgYmxpbmsoaWQpIHsKICAgICAgY29uc29sZS5sb2coJ2JsaW5rICcgKyBpZCkKICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgaWQ6IGlkCiAgICAgIH0KICAgICAgZmV0Y2goYC9ibGlua2AsCiAgICAgICAgICB7CiAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAnaWQnOiBpZCwKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICApCiAgICB9LAogICAgYXN5bmMgYWRkQ29udHJvbGxlcihhcnIsIGRldmljZXMpewogICAgICBjb25zdCB2bT10aGlzCiAgICAgIHZhciBjb250cnMgPSBbXQogICAgICBmb3IgKHZhciBpPTA7IGk8ZGV2aWNlcy5sZW5ndGg7IGkrKyl7CiAgICAgICAgY29udHJzLnB1c2goZGV2aWNlc1tpXS5pZCkKICAgICAgfQogICAgICBmb3IodmFyIGo9MDsgajxhcnIubGVuZ3RoOyBqKyspewogICAgICAgIGF4aW9zLnBvc3QoJy9hcGkvYXJlYScsIHsKICAgICAgICAgICAgICBjb250cm9sbGVyczogY29udHJzLAogICAgICAgICAgICAgIGNhbWVyYV9pZDogdGhpcy5pZCwKICAgICAgICAgICAgICBjb29yZGluYXRlczogYXJyW2pdLmRvdHMKICAgICAgICAgICAgfSkKICAgICAgfQogICAgICB2bS4kcm91dGVyLnB1c2goJy9jYW1lcmFzJykKICAgICAgICAvLyBmb3IgKHZhciBqPTA7IGo8YXJyLmxlbmd0aDsgaisrKXsKICAgICAgICAvLyAgIGZvciAodmFyIGs9MDtrPGFycltqXS5kb3RzLmxlbmd0aDsgaysrKXsKICAgICAgICAvLyAgICAgYXJlYS5wdXNoKFthcnJbal0uZG90c1trXVswXSxhcnJbal0uZG90c1trXVsxXV0pCiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gICBjb25zb2xlLmxvZyhhcmVhKQogICAgICAgIC8vICAgYXhpb3MucG9zdCgnaHR0cDovLzE5Mi4xNjguMS4xMDU6NTAwMC9hcGkvYXJlYXMnLCB7CiAgICAgICAgLy8gICAgIGNvbnRyb2xsZXJzOiBbZGV2aWNlc1tpXS5pZF0sCiAgICAgICAgLy8gICAgIGNhbWVyYV9pZDogdGhpcy5pZCwKICAgICAgICAvLyAgICAgY29vcmRpbmF0ZXM6IGFyZWEKICAgICAgICAvLyAgIH0pCiAgICAgICAgLy8gICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgICAgLy8gICAgICAgfSkKICAgICAgICAvLyAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgLy8gICAgICAgfSk7CiAgICAgICAgLy8gICBhcmVhID0gW10KICAgICAgLy8gfQogICAgfSwKICB9Cn0K"},{"version":3,"sources":["addController.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addController.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"addController\">\n    <div>\n      <b-row class=\"p-2\">\n        <b-col>\n            <h5>Доступные устройства ({{ controllers.length }})</h5>\n            <div class=\"p-2\">\n              <b-table responsive fixed :items=\"controllers\" :fields=\"columns\" table-variant=\"secondary\">\n                <template #cell(button1)=\"row\">\n                  <b-button size=\"sm\" class=\"mr-2\" @click=\"blink(row.item.id)\">\n                    Сигнал\n                  </b-button>\n                </template>\n                <template #cell(button2)=\"row\">\n                  <b-button size=\"sm\" @click=\"chooseDevive(row.index)\" class=\"mr-2\">\n                    Добавить\n                  </b-button>\n                </template>\n              </b-table>\n            </div>\n        </b-col>\n        <b-col>\n          <div>\n            <h5>Выбранные устройства ({{ selectedDevices.length }})</h5>\n            <div class=\"p-2\">\n              <b-table responsive :items=\"selectedDevices\" :fields=\"columns\" table-variant=\"secondary\">\n                <template #cell(button1)=\"row\">\n                  <b-button size=\"sm\" class=\"mr-2\" @click=\"blink(row.item.id)\">\n                    Сигнал\n                  </b-button>\n                </template>\n                <template #cell(button2)=\"row\">\n                  <b-button size=\"sm\" @click=\"deleteDevive(row.index, row.item.id)\" class=\"mr-2\">\n                    Удалить\n                  </b-button>\n                </template>\n              </b-table>\n            </div>\n          </div>\n        </b-col>\n      </b-row>\n    </div>\n\n\n    <div class=\"my-3\">\n      <b-card class=\"bg-sec\">\n        <div class=\"text-center mt-2\">\n          <b-button variant=\"dark\" @click=\"addController(arr, selectedDevices)\">Прикрепить к {{arr.length}} областям</b-button>\n        </div>\n      </b-card>\n<!--      <div v-if=\"groupAlert\" class=\"fixed-top w-100 h-100\" style=\"z-index: 5; background-color: rgba(0,0,0,0.7)\" />-->\n<!--      <b-alert-->\n<!--          dismissible-->\n<!--          v-model=\"groupAlert\"-->\n<!--          variant=\"dark\"-->\n<!--          class=\"position-fixed\"-->\n<!--          style=\"top: 10vh; left: 10vw; width: 80vw; height: 80vh; z-index: 10; padding: 5%;\"-->\n<!--      >-->\n<!--        <div class=\"my-3\">-->\n<!--          <h3>Создание группы</h3>-->\n<!--          <div class=\"px-2\">-->\n<!--            <h5>Выбранные устройства: </h5>-->\n<!--            <div class=\"text-center mt-4\">-->\n<!--              <b-button variant=\"dark\" @click=\"createGroup()\">Создать группу</b-button>-->\n<!--            </div>-->\n<!--          </div>-->\n<!--        </div>-->\n<!--      </b-alert>-->\n    </div>\n  </div>\n</template>\n\n<script>\nimport controllers from \"@/views/controllers\";\nimport axios from \"axios\";\nexport default {\nname: \"addController.vue\",\n  props: ['arr', 'id'],\n  components: {\n    controllers\n  },\n  data() {\n    return {\n      controllers: [],\n      selectedDevices: [],\n      columns: [\n        {key: 'id', label: 'ID'},\n        {key: 'button1', label: 'Подать сигнал'},\n        {key: 'button2', label: 'Выбрать'},\n      ],\n      groupAlert: false,\n    }\n  },\n  mounted() {\n    this.getFreeDevices()\n  },\n  methods: {\n    getFreeDevices() {\n      axios.get('/api/controllers')\n          .then(response => (this.controllers = response.data));\n    },\n    async chooseDevive(id) {\n      // console.log('choosing ' + id);\n      this.selectedDevices.push(this.controllers[id])\n      this.controllers.splice(id, 1)\n    },\n    async deleteDevive(id, cid) {\n      // console.log('deleting ' + id);\n      this.controllers.push(this.selectedDevices[id])\n      this.removeByAttr(this.selectedDevices, 'cid', cid)\n    },\n    async removeByAttr(arr, attr, value){\n      var i = arr.length;\n      while(i--){\n        if( arr[i]\n            && arr[i].hasOwnProperty(attr)\n            && (arguments.length > 2 && arr[i][attr] === value ) ){\n          arr.splice(i,1);\n        }\n      }\n      return arr;\n    },\n    blink(id) {\n      console.log('blink ' + id)\n      let data = {\n        id: id\n      }\n      fetch(`/blink`,\n          {\n            method: \"POST\",\n            body: JSON.stringify(data),\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n              'id': id,\n            }\n          }\n      )\n    },\n    async addController(arr, devices){\n      const vm=this\n      var contrs = []\n      for (var i=0; i<devices.length; i++){\n        contrs.push(devices[i].id)\n      }\n      for(var j=0; j<arr.length; j++){\n        axios.post('/api/area', {\n              controllers: contrs,\n              camera_id: this.id,\n              coordinates: arr[j].dots\n            })\n      }\n      vm.$router.push('/cameras')\n        // for (var j=0; j<arr.length; j++){\n        //   for (var k=0;k<arr[j].dots.length; k++){\n        //     area.push([arr[j].dots[k][0],arr[j].dots[k][1]])\n        //   }\n        //   console.log(area)\n        //   axios.post('http://192.168.1.105:5000/api/areas', {\n        //     controllers: [devices[i].id],\n        //     camera_id: this.id,\n        //     coordinates: area\n        //   })\n        //       .then(function (response) {\n        //         console.log(response);\n        //       })\n        //       .catch(function (error) {\n        //         console.log(error);\n        //       });\n        //   area = []\n      // }\n    },\n  }\n}\n</script>"]}]}